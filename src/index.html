<!doctype html>
<html>
  <head>
    <title><%= json.project.title %></title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" type="text/css" href="style.css">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://rawgit.com/rzajac/angularjs-slider/master/dist/rzslider.css"/>
    <%= t.include("partials/_head.html") %>
    <%= t.include("partials/_analytics_hearst.html") %>

    <script src="app.js" async></script>

  </head>
  <body ng-app="drought">

    <responsive-child>
      <div ng-controller="DroughtController">
        <div class="drought-container">

        <img src="./assets/drought_img.jpeg"></img>
        <div class="title" id="title">When will the drought end?</div>
        <a class="share-button"></a>
        <div class="chatter">We’ve had some wet weather this winter, but it’s much <a href="http://www.sfchronicle.com/bayarea/article/How-much-El-Ni-o-rain-needed-to-end-drought-6754540.php" target="_blank">too soon</a> to stop conserving water. Move the sliders below to see what combination of rain and snow is needed for California to see drought relief.</div>

        <div class="head" id="drought">Choose a city:</div>
        <select class="select-class"
                ng-model="selectedCity"
                ng-change=reset()
                ng-options="row.id as row.city for row in rainData">
        </select>
        <div class="head" id="head">Choose city's rain level for the season:</div>
        <div class="rain-text2">Remember, a light storm might bring a quarter inch of rain while the bigger ones can bring a few inches.</div>
        <rzslider rz-slider-model="rain_slider.value"
                  rz-slider-options="rain_slider.options"
                  style="position:relative"
                  ng-click="round_rain_numbers(rain_slider.value); set_page()"></rzslider>
        <div class="avg_rain" style="left: {{(rainRow.normal_rainfall+add_factor)*(0.95*win_width-32)/60 + edge_width}}px"></div>
        <div class="avg_rain_label" style="left: {{(rainRow.normal_rainfall+add_factor)*(0.95*win_width-32)/60 - edge_width/2-12}}px">Average rain: {{rainRow.normal_rainfall}} inches</div>
        <div class="current_rain" style="left: {{(rainRow.current_rainfall+add_factor)*(0.95*win_width-32)/60 + edge_width}}px"></div>
        <div class="current_rain_label" style="left: {{(rainRow.current_rainfall+add_factor)*(0.95*win_width-32)/60 - edge_width/2}}px">Current rain: {{rainRow.current_rainfall}} inches</div>

        <div class="rain-text">
          <div class="rain-inches">{{rain_slider.value}}</div>
           inches of rain is
          <div class="rain-percent">{{rain_percent}}</div>
           % of average.
        </div>

         <div class="rain-text-mobile">
           <div class="rain-inches">{{rain_slider.value}}</div>
            in. of rain is
           <div class="rain-percent">{{rain_percent}}</div>
            % of average.
        </div>

        <div class="head">Choose Sierra snow level for the season:</div>
        <div class="snow-text2">A winter storm often brings several inches of snow to the mountains, sometimes several feet. Snow is important because it provides much of the state’s water supply.</div>
        <div class="snow-text2-mobile">A winter storm brings several inches of snow to the mountains, sometimes several feet.</div>
        <rzslider rz-slider-model="snow_slider.value"
                  rz-slider-options="snow_slider.options"
                  ng-click="set_page()"></rzslider>
        <div class="avg_snow" style="position: relative; left: {{(snowData[0].normal_inches+snow_add_factor)*(0.95*win_width-32)/120+edge_width}}px"></div>
        <div class="avg_snow_label" style="left: {{(snowData[0].normal_inches+snow_add_factor)*(0.95*win_width-32)/120-edge_width/2}}px">Average snow: {{snowData[0].normal_inches}} inches</div>
        <div class="current_snow" style="position: relative; left: {{(snowData[0].current_inches+snow_add_factor)*(0.95*win_width-32)/120+edge_width}}px"></div>
        <div class="current_snow_label" style="left: {{(snowData[0].current_inches+snow_add_factor)*(0.95*win_width-32)/120-edge_width/2}}px">Current snow: {{snowData[0].current_inches}} inches</div>

        <div class="snow-text">
          <div class="snow-inches">{{snow_slider.value}}</div>
           inches of snow is
          <div class="snow-percent">{{snow_percent}}</div>
           % of average.
         </div>

         <div class="snow-text-mobile">
           <div class="snow-inches">{{snow_slider.value}}</div>
            in. of snow is
           <div class="snow-percent">{{snow_percent}}</div>
            % of average.
          </div>

        <div class="answer">
          <div class="spacing_hack"></div>
          <div class="color-text no"
            ng-class="{active: rain_slider.value/rainRow.normal_rainfall < (rainRow.percent_req/100) && snow_slider.value < snowData[0].goal_inches}">No, the drought is not over! Both rain and snow are short of what’s needed for relief.</div>
          <div class="color-text maybe"
            ng-class="{active: (rain_slider.value/rainRow.normal_rainfall >= (rainRow.percent_req/100) || snow_slider.value >= snowData[0].goal_inches) && !(rain_slider.value/rainRow.normal_rainfall >= (rainRow.percent_req/100) && snow_slider.value >= snowData[0].goal_inches)}">Improvement! Either enough rain or snow has fallen to provide significant drought relief. But one may be lagging.</div>
          <div class="color-text yes"
            ng-class="{active: rain_slider.value/rainRow.normal_rainfall >= (rainRow.percent_req/100) && snow_slider.value >= snowData[0].goal_inches}">Yes, a big dent was made in the drought! Both enough rain and snow have fallen to patch deficits and provide relief.</div>
        </div>

        <div class="methodology"><div class="methodology-title">Methodology:  </div>  The Chronicle’s criteria for drought relief are based on state and federal estimates of how much rain and snow are needed to make up for recent deficits. The rain calculation is derived from <a href="https://www.climate.gov/sites/default/files/CA_precip_needed_2015_large.png" target="_blank">U.S. Climate Prediction Center figures</a> on what’s required, by region, to move out of the bottom 20th percentile of the five-year precipitation total. The snow calculation is based on the California Department of Water Resources’ estimate of how much water will have to be in the <a href="http://cdec.water.ca.gov/cdecapp/snowapp/sweq.action" target="_blank">Sierra snowpack, averaged across 96 weather stations</a>, on April 1, to provide drought relief. This tool is intended to give only a general idea of when the drought will subside and is not definitive. <a href="http://www.sfchronicle.com/drought/" target="_blank">Check out SFChronicle.com's Running Dry project</a> for complete drought coverage.
        </div>

      </div>
    </div>

    <div class="credits">
      Reporting by <span class="credit-name">Kurtis Alexander</span> &bull; Web development by <span class="credit-name">Emma O'Neill</span>
    </div>


    <footer>
      <a class="logo" href="http://www.sfchronicle.com">
        <img src="./assets/sf_logo_white.png">
      </a>
    </footer>

    </responsive-child>

    <script>
      var rainData = <%= JSON.stringify(json.Drought_rainfall) %>
      var snowData = <%= JSON.stringify(json.Drought_snow) %>
    </script>

    <script>
      var doc = document.documentElement;
      doc.setAttribute('data-browser', navigator.userAgent);
    </script>

    <%= t.include("partials/_foot.html") %>
    <%= t.include("partials/_helloSFC.html") %>
  </body>
</html>
